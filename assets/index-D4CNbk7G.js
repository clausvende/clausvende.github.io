`)}return""+e},t}();function Xn(i){return Number(i||0).toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}function R3(i,t){const e=[...i].sort((c,f)=>c.date-f.date),r=[...t].sort((c,f)=>c.date-f.date);let a=0,l=r[a]?.amount||0;for(const c of e){let f=0;for(;a<r.length&&f<c.amount;){const p=Math.min(l,c.amount-f);f+=p,l-=p,l===0&&(a+=1,l=r[a]?.amount||0)}c.abonado=f,c.pendiente=Math.max(0,c.amount-f),c.pagada=c.pendiente===0}return i}function UN(i,t){const e=[...i].sort((c,f)=>c.date-f.date),r=[...t].sort((c,f)=>c.date-f.date).map(c=>({...c}));let a=0,l=e[a]?.amount||0;for(const c of r){let f=c.amount;for(;a<e.length&&f>0;){c.saleId||(c.saleId=e[a].id,c.saleDescription=e[a].description);const p=Math.min(f,l);f-=p,l-=p,l===0&&(a+=1,l=e[a]?.amount||0)}}return r}function BN({clientId:i}){const[t,e]=me.useState(null),[r,a]=me.useState([]),[l,c]=me.useState([]);me.useEffect(()=>{(async()=>{const E=await S0(Tn(Le,"clients",i));if(!E.exists())return;e({id:E.id,...E.data()});const A=(await Yr(Si(Le,"clients",i,"sales"))).docs.map(j=>({id:j.id,...j.data()})),V=(await Yr(Si(Le,"clients",i,"payments"))).docs.map(j=>({id:j.id,...j.data()}));R3(A,V);const G=UN(A,V);a(A),c(G)})()},[i]);const f=()=>{const v=new Ce({format:"a5"}),E=v.internal.pageSize.getWidth(),T=v.internal.pageSize.getHeight(),A=10;let R=A;v.setFontSize(16),v.text("Vende Más",E/2,R,{align:"center"}),R+=7,v.setFontSize(12),v.text("Estado de Cuenta",E/2,R,{align:"center"}),R+=3,v.line(A,R,E-A,R),R+=6,v.setFontSize(10),v.text(`Nombre: ${t.name}`,A,R),R+=4,v.text(`Teléfono: ${t.phone}`,A,R),R+=4,v.text(`Fecha: ${new Date().toLocaleDateString()}`,A,R),R+=6,v.setFontSize(12),v.text("Resumen",A,R),R+=5,v.setFontSize(10);const V=[["Total comprado",Xn(p)],["Total abonado",Xn(y)],["Saldo pendiente",Xn(p-y)]];v.setFont(void 0,"bold"),V.forEach(X=>{v.text(String(X[0]),A,R),v.text(`$${X[1]}`,E-A,R,{align:"right"}),R+=4}),v.setFont(void 0,"normal"),R+=4,v.setFontSize(12),v.text("Detalle de ventas",A,R),R+=4,v.setFontSize(10);const G=[A,A+30,E-55,E-35,E-A];v.setFont(void 0,"bold"),v.text("Fecha",G[0],R),v.text("Producto",G[1],R),v.text("Monto",G[2],R,{align:"right"}),v.text("Abonado",G[3],R,{align:"right"}),v.text("Saldo",G[4],R,{align:"right"}),v.setFont(void 0,"normal"),R+=2,v.line(A,R,E-A,R),R+=4,r.sort((X,nt)=>X.date-nt.date).forEach(X=>{v.text(String(new Date(X.date).toLocaleDateString()),G[0],R),v.text(String(X.description),G[1],R),v.text(`$${Xn(X.amount)}`,G[2],R,{align:"right"}),v.text(`$${Xn(X.abonado)}`,G[3],R,{align:"right"}),v.text(X.pagada?"✔":`$${Xn(X.pendiente)}`,G[4],R,{align:"right"}),R+=4,R>T-A&&(v.addPage(),R=A)}),R+=6,v.setFontSize(12),v.text("Detalle de abonos",A,R),R+=4,v.setFontSize(10);const j=[A,A+30,E-A];v.setFont(void 0,"bold"),v.text("Fecha",j[0],R),v.text("Venta",j[1],R),v.text("Monto",j[2],R,{align:"right"}),v.setFont(void 0,"normal"),R+=2,v.line(A,R,E-A,R),R+=4,l.sort((X,nt)=>X.date-nt.date).forEach(X=>{v.text(String(new Date(X.date).toLocaleDateString()),j[0],R),X.saleDescription&&v.text(String(X.saleDescription),j[1],R),v.text(`$${Xn(X.amount)}`,j[2],R,{align:"right"}),R+=4,R>T-A&&(v.addPage(),R=A)}),v.setFontSize(9),v.text("¡Gracias por su preferencia!",E/2,T-A,{align:"center"}),v.save(`estado-${t.name}.pdf`)};if(!t)return H.jsx("p",{children:"Cargando..."});const p=r.reduce((v,E)=>v+E.amount,0),y=l.reduce((v,E)=>v+E.amount,0);return H.jsxs("div",{className:"space-y-6 max-w-2xl",children:[H.jsxs("h2",{className:"text-xl font-bold flex items-center justify-center gap-2",children:[H.jsx("span",{role:"img","aria-hidden":"true",children:"📋"}),"Estado de cuenta"]}),H.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 grid gap-x-4 gap-y-2 text-sm sm:grid-cols-2",children:[H.jsxs("p",{children:[H.jsx("span",{className:"font-semibold",children:"Nombre:"})," ",t.name]}),H.jsxs("p",{children:[H.jsx("span",{className:"font-semibold",children:"Teléfono:"})," ",t.phone]}),t.notes&&H.jsxs("p",{className:"sm:col-span-2",children:[H.jsx("span",{className:"font-semibold",children:"Notas:"})," ",t.notes]}),H.jsxs("p",{className:"sm:col-span-2",children:[H.jsx("span",{className:"font-semibold",children:"Saldo actual:"})," $",Xn(t.balance)]})]}),H.jsx("hr",{className:"border-gray-300"}),H.jsxs("div",{className:"space-y-2",children:[H.jsx("h3",{className:"text-lg font-semibold",children:"Ventas"}),H.jsx("div",{className:"overflow-x-auto",children:H.jsxs("table",{className:"min-w-full text-sm border border-gray-200",children:[H.jsx("thead",{className:"bg-gray-100 text-gray-700",children:H.jsxs("tr",{children:[H.jsx("th",{className:"p-2 text-left",children:"Fecha"}),H.jsx("th",{className:"p-2 text-left",children:"Descripción"}),H.jsx("th",{className:"p-2 text-right",children:"Monto"}),H.jsx("th",{className:"p-2 text-center",children:"Estado"})]})}),H.jsx("tbody",{children:r.slice().sort((v,E)=>v.date-E.date).map(v=>H.jsxs("tr",{className:"border-t",children:[H.jsx("td",{className:"p-2",children:new Date(v.date).toLocaleDateString()}),H.jsx("td",{className:"p-2",children:v.description}),H.jsxs("td",{className:"p-2 text-right",children:["$",Xn(v.amount)]}),H.jsx("td",{className:"p-2 text-center",children:v.pagada?H.jsx("span",{className:"inline-flex items-center gap-1 bg-green-100 text-green-800 px-2 py-1 rounded-full text-xs font-medium",children:"✔ Pagada"}):H.jsx("span",{className:"inline-flex items-center gap-1 bg-yellow-100 text-yellow-800 px-2 py-1 rounded-full text-xs font-medium",children:"⏳ Pendiente"})})]},v.id))})]})})]}),H.jsx("hr",{className:"border-gray-300"}),H.jsxs("div",{className:"space-y-2",children:[H.jsx("h3",{className:"text-lg font-semibold",children:"Abonos"}),H.jsx("div",{className:"overflow-x-auto",children:H.jsxs("table",{className:"min-w-full text-sm border border-gray-200",children:[H.jsx("thead",{className:"bg-gray-100 text-gray-700",children:H.jsxs("tr",{children:[H.jsx("th",{className:"p-2 text-left",children:"Fecha"}),H.jsx("th",{className:"p-2 text-left",children:"Venta"}),H.jsx("th",{className:"p-2 text-right",children:"Monto"})]})}),H.jsx("tbody",{children:l.slice().sort((v,E)=>v.date-E.date).map(v=>H.jsxs("tr",{className:"border-t",children:[H.jsx("td",{className:"p-2",children:new Date(v.date).toLocaleDateString()}),H.jsx("td",{className:"p-2",children:v.saleDescription||""}),H.jsxs("td",{className:"p-2 text-right",children:["$",Xn(v.amount)]})]},v.id))})]})})]}),H.jsx("hr",{className:"border-gray-300"}),H.jsxs("div",{className:"space-y-1 text-right",children:[H.jsxs("p",{className:"font-semibold",children:["Total compras: $",Xn(p)]}),H.jsxs("p",{className:"font-semibold",children:["Total abonos: $",Xn(y)]})]}),H.jsx("div",{className:"text-center",children:H.jsxs("button",{onClick:f,className:"inline-flex items-center gap-2 bg-blue-600 hover:bg-blue-700 text-white font-semibold px-4 py-2 rounded",children:[H.jsx("span",{role:"img","aria-hidden":"true",children:"🖨️"}),"Generar PDF"]})})]})}function C3({clientId:i,onDone:t}){const[e,r]=me.useState(""),[a,l]=me.useState(new Date().toISOString().split("T")[0]),c=async f=>{f.preventDefault();const p=parseFloat(e);isNaN(p)||!a||(await p1(Si(Le,"clients",i,"payments"),{amount:p,date:new Date(a).getTime()}),await Kr(Tn(Le,"clients",i),{balance:ws(-p)}),t&&t())};return H.jsxs("form",{onSubmit:c,className:"bg-white p-4 rounded shadow max-w-md mx-auto space-y-4",children:[H.jsx("h2",{className:"text-lg font-semibold text-center",children:"Registrar abono"}),H.jsx("input",{className:"w-full border rounded px-3 py-2",value:e,onChange:f=>r(f.target.value),placeholder:"Monto del abono",type:"number",step:"0.01",required:!0}),H.jsx("input",{className:"w-full border rounded px-3 py-2",type:"date",value:a,onChange:f=>l(f.target.value),required:!0}),H.jsx("button",{type:"submit",className:"w-full bg-blue-500 text-white py-2 rounded",children:"Guardar"})]})}const FN="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%2024%2024'%20fill='currentColor'%20aria-hidden='true'%3e%3cpath%20d='M12%2015a3%203%200%20100-6%203%203%200%20000%206z'/%3e%3cpath%20fill-rule='evenodd'%20d='M1.323%2011.447C2.811%206.976%207.028%203.75%2012.001%203.75c4.97%200%209.185%203.223%2010.675%207.69.12.362.12.752%200%201.113-1.487%204.471-5.705%207.697-10.677%207.697-4.97%200-9.186-3.223-10.675-7.69a1.762%201.762%200%20010-1.113zM17.25%2012a5.25%205.25%200%2011-10.5%200%205.25%205.25%200%200110.5%200z'%20clip-rule='evenodd'/%3e%3c/svg%3e",qN="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%2024%2024'%20fill='currentColor'%20aria-hidden='true'%3e%3cpath%20fill-rule='evenodd'%20d='M5.625%201.5c-1.036%200-1.875.84-1.875%201.875v17.25c0%201.035.84%201.875%201.875%201.875h12.75c1.035%200%201.875-.84%201.875-1.875V12.75A3.75%203.75%200%200016.5%209h-1.875a1.875%201.875%200%2001-1.875-1.875V5.25A3.75%203.75%200%20009%201.5H5.625zM7.5%2015a.75.75%200%2001.75-.75h7.5a.75.75%200%20010%201.5h-7.5A.75.75%200%20017.5%2015zm.75%202.25a.75.75%200%20000%201.5H12a.75.75%200%20000-1.5H8.25z'%20clip-rule='evenodd'/%3e%3cpath%20d='M12.971%201.816A5.23%205.23%200%200114.25%205.25v1.875c0%20.207.168.375.375.375H16.5a5.23%205.23%200%20013.434%201.279%209.768%209.768%200%2000-6.963-6.963z'/%3e%3c/svg%3e",L3="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%2024%2024'%20fill='currentColor'%20aria-hidden='true'%3e%3cpath%20d='M4.913%202.658c2.075-.27%204.19-.408%206.337-.408%202.147%200%204.262.139%206.337.408%201.922.25%203.291%201.861%203.405%203.727a4.403%204.403%200%2000-1.032-.211%2050.89%2050.89%200%2000-8.42%200c-2.358.196-4.04%202.19-4.04%204.434v4.286a4.47%204.47%200%20002.433%203.984L7.28%2021.53A.75.75%200%20016%2021v-4.03a48.527%2048.527%200%2001-1.087-.128C2.905%2016.58%201.5%2014.833%201.5%2012.862V6.638c0-1.97%201.405-3.718%203.413-3.979z'/%3e%3cpath%20d='M15.75%207.5c-1.376%200-2.739.057-4.086.169C10.124%207.797%209%209.103%209%2010.609v4.285c0%201.507%201.128%202.814%202.67%202.94%201.243.102%202.5.157%203.768.165l2.782%202.781a.75.75%200%20001.28-.53v-2.39l.33-.026c1.542-.125%202.67-1.433%202.67-2.94v-4.286c0-1.505-1.125-2.811-2.664-2.94A49.392%2049.392%200%200015.75%207.5z'/%3e%3c/svg%3e",vh="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%2024%2024'%20fill='currentColor'%20aria-hidden='true'%3e%3cpath%20d='M21.731%202.269a2.625%202.625%200%2000-3.712%200l-1.157%201.157%203.712%203.712%201.157-1.157a2.625%202.625%200%20000-3.712zM19.513%208.199l-3.712-3.712-8.4%208.4a5.25%205.25%200%2000-1.32%202.214l-.8%202.685a.75.75%200%2000.933.933l2.685-.8a5.25%205.25%200%20002.214-1.32l8.4-8.4z'/%3e%3cpath%20d='M5.25%205.25a3%203%200%2000-3%203v10.5a3%203%200%20003%203h10.5a3%203%200%20003-3V13.5a.75.75%200%2000-1.5%200v5.25a1.5%201.5%200%2001-1.5%201.5H5.25a1.5%201.5%200%2001-1.5-1.5V8.25a1.5%201.5%200%20011.5-1.5h5.25a.75.75%200%20000-1.5H5.25z'/%3e%3c/svg%3e",Of="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%2024%2024'%20fill='currentColor'%20aria-hidden='true'%3e%3cpath%20fill-rule='evenodd'%20d='M16.5%204.478v.227a48.816%2048.816%200%20013.878.512.75.75%200%2011-.256%201.478l-.209-.035-1.005%2013.07a3%203%200%2001-2.991%202.77H8.084a3%203%200%2001-2.991-2.77L4.087%206.66l-.209.035a.75.75%200%2001-.256-1.478A48.567%2048.567%200%20017.5%204.705v-.227c0-1.564%201.213-2.9%202.816-2.951a52.662%2052.662%200%20013.369%200c1.603.051%202.815%201.387%202.815%202.951zm-6.136-1.452a51.196%2051.196%200%20013.273%200C14.39%203.05%2015%203.684%2015%204.478v.113a49.488%2049.488%200%2000-6%200v-.113c0-.794.609-1.428%201.364-1.452zm-.355%205.945a.75.75%200%2010-1.5.058l.347%209a.75.75%200%20101.499-.058l-.346-9zm5.48.058a.75.75%200%2010-1.498-.058l-.347%209a.75.75%200%20001.5.058l.345-9z'%20clip-rule='evenodd'/%3e%3c/svg%3e",Um="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%2024%2024'%20fill='currentColor'%20aria-hidden='true'%3e%3cpath%20fill-rule='evenodd'%20d='M12%203.75a.75.75%200%2001.75.75v6.75h6.75a.75.75%200%20010%201.5h-6.75v6.75a.75.75%200%2001-1.5%200v-6.75H4.5a.75.75%200%20010-1.5h6.75V4.5a.75.75%200%2001.75-.75z'%20clip-rule='evenodd'/%3e%3c/svg%3e",Tp="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%2024%2024'%20fill='currentColor'%20aria-hidden='true'%3e%3cpath%20d='M10.464%208.746c.227-.18.497-.311.786-.394v2.795a2.252%202.252%200%2001-.786-.393c-.394-.313-.546-.681-.546-1.004%200-.323.152-.691.546-1.004zM12.75%2015.662v-2.824c.347.085.664.228.921.421.427.32.579.686.579.991%200%20.305-.152.671-.579.991a2.534%202.534%200%2001-.921.42z'/%3e%3cpath%20fill-rule='evenodd'%20d='M12%202.25c-5.385%200-9.75%204.365-9.75%209.75s4.365%209.75%209.75%209.75%209.75-4.365%209.75-9.75S17.385%202.25%2012%202.25zM12.75%206a.75.75%200%2000-1.5%200v.816a3.836%203.836%200%2000-1.72.756c-.712.566-1.112%201.35-1.112%202.178%200%20.829.4%201.612%201.113%202.178.502.4%201.102.647%201.719.756v2.978a2.536%202.536%200%2001-.921-.421l-.879-.66a.75.75%200%2000-.9%201.2l.879.66c.533.4%201.169.645%201.821.75V18a.75.75%200%20001.5%200v-.81a4.124%204.124%200%20001.821-.749c.745-.559%201.179-1.344%201.179-2.191%200-.847-.434-1.632-1.179-2.191a4.122%204.122%200%2000-1.821-.75V8.354c.29.082.559.213.786.393l.415.33a.75.75%200%2000.933-1.175l-.415-.33a3.836%203.836%200%2000-1.719-.755V6z'%20clip-rule='evenodd'/%3e%3c/svg%3e";function Uv({go:i}){const[t,e]=me.useState([]),[r,a]=me.useState(""),[l,c]=me.useState(!1),[f,p]=me.useState(null),[y,v]=me.useState(null),[E,T]=me.useState(null),{role:A}=nd(),R=async()=>{const j=await Yr(Si(Le,"clients"));e(j.docs.map(X=>({id:X.id,...X.data()})))};me.useEffect(()=>{R()},[]);const V=t.filter(j=>j.name.toLowerCase().includes(r.toLowerCase())),G=async j=>{window.confirm("¿Eliminar este cliente?")&&(await ch(Tn(Le,"clients",j.id)),R())};return H.jsxs("div",{className:"space-y-4",children:[H.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-2",children:[H.jsxs("button",{onClick:()=>c(!0),className:"flex items-center gap-2 bg-blue-500 text-white px-3 py-2 rounded w-full sm:w-auto",children:[H.jsx("img",{src:Um,alt:"",className:"w-5 h-5"}),"Nuevo cliente"]}),H.jsxs("div",{className:"relative w-full sm:w-auto",children:[H.jsx("input",{className:"border rounded px-3 py-2 pr-8 w-full",placeholder:"Buscar cliente",value:r,onChange:j=>a(j.target.value)}),r&&H.jsx("button",{type:"button",onClick:()=>a(""),className:"absolute right-2 top-1/2 -translate-y-1/2 text-gray-700",children:"×"})]})]}),H.jsx("ul",{className:"grid gap-3",children:V.map(j=>{const X=(j.phone||"").replace(/\D/g,"");return H.jsxs("li",{className:"card border-l-4 border-blue-500",children:[H.jsxs("div",{className:"flex-1",children:[H.jsx("p",{className:"font-semibold",children:j.name}),H.jsxs("p",{className:"text-sm text-gray-800",children:["Deuda: ",`$${Xn(j.balance)}`]})]}),H.jsxs("span",{className:"actions",children:[H.jsx("button",{onClick:()=>i("client",j.id),title:"Ver",children:H.jsx("img",{src:FN,alt:"ver",className:"icon"})}),H.jsx("button",{onClick:()=>v(j.id),title:"Estado",children:H.jsx("img",{src:qN,alt:"estado",className:"icon"})}),H.jsx("button",{onClick:()=>T(j.id),title:"Abono",children:H.jsx("img",{src:Tp,alt:"abono",className:"icon"})}),X&&H.jsx("a",{href:`https://wa.me/${X}`,target:"_blank",rel:"noopener noreferrer",title:"Mensaje",children:H.jsx("img",{src:L3,alt:"mensaje",className:"icon"})}),A==="Administrador"&&H.jsxs(H.Fragment,{children:[H.jsx("button",{onClick:()=>p(j),title:"Editar",children:H.jsx("img",{src:vh,alt:"editar",className:"icon"})}),H.jsx("button",{onClick:()=>G(j),title:"Eliminar",children:H.jsx("img",{src:Of,alt:"eliminar",className:"icon"})})]})]})]},j.id)})}),l&&H.jsx(Oo,{onClose:()=>c(!1),children:H.jsx(N0,{onDone:()=>{c(!1),R()}})}),f&&H.jsx(Oo,{onClose:()=>p(null),children:H.jsx(N0,{client:f,onDone:()=>{p(null),R()}})}),y&&H.jsx(Oo,{onClose:()=>v(null),children:H.jsx(BN,{clientId:y})}),E&&H.jsx(Oo,{onClose:()=>T(null),children:H.jsx(C3,{clientId:E,onDone:()=>{T(null),R()}})})]})}function zN({id:i,go:t}){const[e,r]=me.useState(null),[a,l]=me.useState([]),[c,f]=me.useState([]),[p,y]=me.useState(""),[v,E]=me.useState(!1),[T,A]=me.useState(null),[R,V]=me.useState(""),[G,j]=me.useState(""),[X,nt]=me.useState(null),[At,bt]=me.useState(""),[kt,W]=me.useState(""),{role:L}=nd();me.useEffect(()=>{const B=z2(Tn(Le,"clients",i),U=>{r({id:U.id,...U.data()})}),pt=z2(Si(Le,"clients",i,"payments"),U=>{l(U.docs.map(J=>({id:J.id,...J.data()})).sort((J,rt)=>J.date-rt.date))}),P=z2(Si(Le,"clients",i,"sales"),U=>{f(U.docs.map(J=>({id:J.id,...J.data()})).sort((J,rt)=>J.date-rt.date))});return()=>{B(),pt(),P()}},[i]);const z=async B=>{if(B.preventDefault(),!p)return;const pt=parseFloat(p);await p1(Si(Le,"clients",i,"payments"),{amount:pt,date:Date.now()}),await Kr(Tn(Le,"clients",i),{balance:ws(-pt)}),y("")},Z=B=>{A(B.id),V(B.amount),j(new Date(B.date).toISOString().split("T")[0])},I=()=>{A(null),V(""),j("")},C=async B=>{const pt=parseFloat(R);if(isNaN(pt)||!G)return;await Kr(Tn(Le,"clients",i,"payments",B.id),{amount:pt,date:new Date(G).getTime()});const P=pt-B.amount;P!==0&&await Kr(Tn(Le,"clients",i),{balance:ws(-P)}),I()},O=async B=>{window.confirm("¿Eliminar este abono?")&&(await ch(Tn(Le,"clients",i,"payments",B.id)),await Kr(Tn(Le,"clients",i),{balance:ws(B.amount)}))},at=B=>{nt(B.id),bt(B.amount),W(new Date(B.date).toISOString().split("T")[0])},Tt=()=>{nt(null),bt(""),W("")},et=async B=>{const pt=parseFloat(At);if(isNaN(pt)||!kt)return;await Kr(Tn(Le,"clients",i,"sales",B.id),{amount:pt,date:new Date(kt).getTime()});const P=pt-B.amount;P!==0&&await Kr(Tn(Le,"clients",i),{balance:ws(P),total:ws(P)}),Tt()},ht=async B=>{window.confirm("¿Eliminar esta venta?")&&(await ch(Tn(Le,"clients",i,"sales",B.id)),await Kr(Tn(Le,"clients",i),{balance:ws(-B.amount),total:ws(-B.amount)}))},ut=async()=>{window.confirm("¿Eliminar este cliente?")&&(await ch(Tn(Le,"clients",i)),t("clients"))},Nt=R3(c.map(B=>({...B})),a);return e?H.jsxs("div",{className:"space-y-4",children:[H.jsx("button",{onClick:()=>t("list"),className:"bg-blue-500 text-white px-3 py-2 rounded",children:"Regresar"}),H.jsxs("h2",{className:"text-lg font-semibold flex items-center gap-2",children:[e.name,L==="Administrador"&&H.jsxs(H.Fragment,{children:[H.jsx("button",{onClick:()=>E(!0),children:H.jsx("img",{src:vh,alt:"editar",className:"icon"})}),H.jsx("button",{onClick:ut,children:H.jsx("img",{src:Of,alt:"eliminar",className:"icon"})})]})]}),H.jsxs("p",{className:"text-gray-800",children:["Teléfono: ",e.phone]}),e.notes&&H.jsxs("p",{className:"text-gray-800",children:["Observaciones: ",e.notes]}),H.jsxs("p",{className:"text-gray-800",children:["Deuda actual: $",Xn(e.balance)]}),H.jsxs("form",{onSubmit:z,className:"flex gap-2",children:[H.jsx("input",{className:"border rounded px-3 py-2 flex-1",value:p,onChange:B=>y(B.target.value),placeholder:"Monto del abono",type:"number",step:"0.01"}),H.jsx("button",{type:"submit",className:"bg-blue-500 text-white px-3 py-2 rounded",children:"Registrar abono"})]}),H.jsxs("div",{className:"section",children:[H.jsx("h3",{className:"text-lg font-semibold flex items-center gap-2",children:"🛍️ Ventas"}),H.jsx("ul",{className:"grid gap-2",children:Nt.map(B=>H.jsx("li",{className:"card",children:L==="Administrador"&&X===B.id?H.jsxs(H.Fragment,{children:[H.jsx("input",{className:"border rounded px-2 py-1 mr-2",type:"number",step:"0.01",value:At,onChange:pt=>bt(pt.target.value)}),H.jsx("input",{className:"border rounded px-2 py-1 mr-2",type:"date",value:kt,onChange:pt=>W(pt.target.value)}),H.jsx("button",{onClick:()=>et(B),className:"bg-blue-500 text-white px-2 py-1 rounded mr-1",children:"Guardar"}),H.jsx("button",{onClick:Tt,className:"px-2 py-1 rounded border",children:"Cancelar"})]}):H.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-2 w-full",children:[H.jsxs("div",{className:"flex-1 space-y-1",children:[H.jsxs("p",{className:"text-sm flex items-center gap-1",children:[H.jsx("span",{children:"📅"}),new Date(B.date).toLocaleDateString()]}),H.jsxs("p",{className:"text-sm flex items-center gap-1",children:[H.jsx("span",{children:"🛍️"}),B.description]}),H.jsxs("p",{className:"text-sm flex items-center gap-1 font-medium",children:[H.jsx("span",{children:"💲"}),"$",Xn(B.amount)]})]}),H.jsxs("div",{className:"flex items-center gap-2",children:[H.jsx("span",{className:`inline-flex items-center gap-1 text-xs font-medium px-2 py-1 rounded-full ${B.pagada?"bg-green-100 text-green-800":"bg-yellow-100 text-yellow-800"}`,children:B.pagada?"✅ Pagada":"⚠️ Pendiente"}),L==="Administrador"&&H.jsxs(H.Fragment,{children:[H.jsx("button",{onClick:()=>at(B),title:"Editar",children:H.jsx("img",{src:vh,alt:"editar",className:"icon"})}),H.jsx("button",{onClick:()=>ht(B),title:"Eliminar",children:H.jsx("img",{src:Of,alt:"eliminar",className:"icon"})})]})]})]})},B.id))})]}),H.jsxs("div",{className:"section",children:[H.jsx("h3",{className:"text-lg font-semibold flex items-center gap-2",children:"💸 Abonos"}),H.jsx("ul",{className:"grid gap-2",children:a.map(B=>H.jsx("li",{className:"card",children:T===B.id?H.jsxs(H.Fragment,{children:[H.jsx("input",{className:"border rounded px-2 py-1 mr-2",type:"number",step:"0.01",value:R,onChange:pt=>V(pt.target.value)}),H.jsx("input",{className:"border rounded px-2 py-1 mr-2",type:"date",value:G,onChange:pt=>j(pt.target.value)}),H.jsx("button",{onClick:()=>C(B),className:"bg-blue-500 text-white px-2 py-1 rounded mr-1",children:"Guardar"}),H.jsx("button",{onClick:I,className:"px-2 py-1 rounded border",children:"Cancelar"})]}):H.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-2 w-full",children:[H.jsxs("div",{className:"flex-1 space-y-1",children:[H.jsxs("p",{className:"text-sm flex items-center gap-1",children:[H.jsx("span",{children:"📅"}),new Date(B.date).toLocaleDateString()]}),H.jsxs("p",{className:"text-sm flex items-center gap-1 font-medium",children:[H.jsx("span",{children:"💲"}),"$",Xn(B.amount)]})]}),H.jsxs("div",{className:"flex items-center gap-2",children:[H.jsx("button",{onClick:()=>Z(B),title:"Editar",children:H.jsx("img",{src:vh,alt:"editar",className:"icon"})}),H.jsx("button",{onClick:()=>O(B),title:"Eliminar",children:H.jsx("img",{src:Of,alt:"eliminar",className:"icon"})})]})]})},B.id))})]}),L==="Administrador"&&v&&H.jsx(Oo,{onClose:()=>E(!1),children:H.jsx(N0,{client:e,onDone:()=>E(!1)})})]}):H.jsx("p",{children:"Cargando..."})}const HN="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%2024%2024'%20fill='currentColor'%20aria-hidden='true'%3e%3cpath%20d='M2.25%202.25a.75.75%200%20000%201.5h1.386c.17%200%20.318.114.362.278l2.558%209.592a3.752%203.752%200%2000-2.806%203.63c0%20.414.336.75.75.75h15.75a.75.75%200%20000-1.5H5.378A2.25%202.25%200%20017.5%2015h11.218a.75.75%200%2000.674-.421%2060.358%2060.358%200%20002.96-7.228.75.75%200%2000-.525-.965A60.864%2060.864%200%20005.68%204.509l-.232-.867A1.875%201.875%200%20003.636%202.25H2.25zM3.75%2020.25a1.5%201.5%200%20113%200%201.5%201.5%200%2001-3%200zM16.5%2020.25a1.5%201.5%200%20113%200%201.5%201.5%200%2001-3%200z'/%3e%3c/svg%3e",GN="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%2024%2024'%20fill='currentColor'%20aria-hidden='true'%3e%3cpath%20fill-rule='evenodd'%20d='M8.25%206.75a3.75%203.75%200%20117.5%200%203.75%203.75%200%2001-7.5%200zM15.75%209.75a3%203%200%20116%200%203%203%200%2001-6%200zM2.25%209.75a3%203%200%20116%200%203%203%200%2001-6%200zM6.31%2015.117A6.745%206.745%200%200112%2012a6.745%206.745%200%20016.709%207.498.75.75%200%2001-.372.568A12.696%2012.696%200%200112%2021.75c-2.305%200-4.47-.612-6.337-1.684a.75.75%200%2001-.372-.568%206.787%206.787%200%20011.019-4.38z'%20clip-rule='evenodd'/%3e%3cpath%20d='M5.082%2014.254a8.287%208.287%200%2000-1.308%205.135%209.687%209.687%200%2001-1.764-.44l-.115-.04a.563.563%200%2001-.373-.487l-.01-.121a3.75%203.75%200%20013.57-4.047zM20.226%2019.389a8.287%208.287%200%2000-1.308-5.135%203.75%203.75%200%20013.57%204.047l-.01.121a.563.563%200%2001-.373.486l-.115.04c-.567.2-1.156.349-1.764.441z'/%3e%3c/svg%3e";function YN(){const[i,t]=me.useState({outstanding:0,monthlyPayments:0,totalSales:0,recoveryRate:0,avgPayDays:0,topDebtor:null,dueBalance:0,overdueBalance:0,monthlySales:[]}),[e,r]=me.useState([]),[a,l]=me.useState(null),c=me.useRef(null),f=async()=>{const v=await Yr(Si(Le,"clients")),E=Date.now(),T=720*60*60*1e3,A=new Date(new Date().getFullYear(),new Date().getMonth(),1).getTime(),R={};let V=0,G=0,j=0,X=0,nt=0,At={balance:0},bt=0,kt=0;const W=[];for(const O of v.docs){const at=O.data(),Tt=O.id,et=at.balance||0,ht=at.name;V+=et,et>At.balance&&(At={id:Tt,name:ht,balance:et});const ut=await Yr(Si(Le,"clients",Tt,"sales")),Nt=await Yr(Si(Le,"clients",Tt,"payments")),B=ut.docs.map(U=>({id:U.id,...U.data()})).sort((U,J)=>U.date-J.date),pt=Nt.docs.map(U=>({id:U.id,...U.data()})).sort((U,J)=>U.date-J.date);if(B.forEach(U=>{G+=U.amount;const J=new Date(U.date),rt=`${J.getFullYear()}-${String(J.getMonth()+1).padStart(2,"0")}`;R[rt]=(R[rt]||0)+1}),pt.forEach(U=>{U.date>=A&&(j+=U.amount)}),et>0){let U=0;pt.forEach(J=>{J.date>U&&(U=J.date)}),!U&&B.length&&(U=B[B.length-1].date),E-U>=T?(kt+=et,W.push({id:Tt,name:ht,phone:at.phone,balance:et,lastPayment:U})):bt+=et}const P=B.map(U=>({date:U.date,remaining:U.amount}));for(const U of pt){let J=U.amount;for(;J>0&&P.length;){const rt=P[0],lt=Math.min(rt.remaining,J);if(X+=(U.date-rt.date)/(1e3*60*60*24),nt++,rt.remaining-=lt,J-=lt,rt.remaining<=0)P.shift();else break}}}const L=6;let Z=Object.keys(R).sort().slice(-L).map(O=>({month:O,count:R[O]}));if(Z.length===0){const O=new Date;Z=[];for(let at=L-1;at>=0;at--){const Tt=new Date(O.getFullYear(),O.getMonth()-at,1),et=`${Tt.getFullYear()}-${String(Tt.getMonth()+1).padStart(2,"0")}`;Z.push({month:et,count:R[et]||0})}}const I=G?j/G*100:0,C=nt?X/nt:0;t({outstanding:V,monthlyPayments:j,totalSales:G,recoveryRate:I,avgPayDays:C,topDebtor:At,dueBalance:bt,overdueBalance:kt,monthlySales:Z}),r(W)};me.useEffect(()=>{f()},[]);const p=async()=>{const v={},E=await Yr(Si(Le,"clients")),T=[];for(const X of E.docs){const nt=await Yr(Si(Le,"clients",X.id,"sales")),At=await Yr(Si(Le,"clients",X.id,"payments"));T.push({id:X.id,...X.data(),sales:nt.docs.map(bt=>({id:bt.id,...bt.data()})),payments:At.docs.map(bt=>({id:bt.id,...bt.data()}))})}v.clients=T;const A=await Yr(Si(Le,"usuarios"));v.usuarios=A.docs.map(X=>({id:X.id,...X.data()}));const R=await Yr(Si(Le,"users"));v.users=R.docs.map(X=>({id:X.id,...X.data()}));const V=new Blob([JSON.stringify(v,null,2)],{type:"application/json"}),G=URL.createObjectURL(V),j=document.createElement("a");j.href=G,j.download="database.json",j.click(),URL.revokeObjectURL(G)},y=async v=>{const E=v.target.files[0];if(!E)return;const T=await E.text(),A=JSON.parse(T);if(A.clients)for(const R of A.clients){if(await _u(Tn(Le,"clients",R.id),{name:R.name,phone:R.phone,notes:R.notes,balance:R.balance,total:R.total}),R.sales)for(const V of R.sales)await _u(Tn(Le,"clients",R.id,"sales",V.id),{amount:V.amount,date:V.date});if(R.payments)for(const V of R.payments)await _u(Tn(Le,"clients",R.id,"payments",V.id),{amount:V.amount,date:V.date})}if(A.usuarios)for(const R of A.usuarios)await _u(Tn(Le,"usuarios",R.id),R);if(A.users)for(const R of A.users)await _u(Tn(Le,"users",R.id),R);alert("Importación completada")};return H.jsxs("div",{className:"space-y-6",children:[H.jsx("h2",{className:"text-xl font-semibold",children:"Panel de Finanzas"}),H.jsxs("div",{className:"grid gap-4 sm:grid-cols-2 lg:grid-cols-3",children:[H.jsxs("div",{className:"bg-white p-4 rounded shadow flex items-center gap-3",children:[H.jsx("img",{src:Tp,alt:"",className:"w-6 h-6 text-blue-600"}),H.jsxs("div",{children:[H.jsx("p",{className:"text-sm text-gray-600",children:"Saldo por cobrar"}),H.jsx("p",{className:"text-lg font-bold",children:`$${Xn(i.outstanding)}`})]})]}),H.jsxs("div",{className:"bg-white p-4 rounded shadow flex items-center gap-3",children:[H.jsx("img",{src:Tp,alt:"",className:"w-6 h-6 text-green-600"}),H.jsxs("div",{children:[H.jsx("p",{className:"text-sm text-gray-600",children:"Abonos del mes"}),H.jsx("p",{className:"text-lg font-bold",children:`$${Xn(i.monthlyPayments)}`})]})]}),H.jsxs("div",{className:"bg-white p-4 rounded shadow flex items-center gap-3",children:[H.jsx("img",{src:HN,alt:"",className:"w-6 h-6 text-blue-600"}),H.jsxs("div",{children:[H.jsx("p",{className:"text-sm text-gray-600",children:"Total ventas a crédito"}),H.jsx("p",{className:"text-lg font-bold",children:`$${Xn(i.totalSales)}`})]})]}),H.jsxs("div",{className:"bg-white p-4 rounded shadow flex items-center gap-3",children:[H.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"w-6 h-6 text-blue-600",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true",children:H.jsx("path",{d:"M2.25 13.5A8.25 8.25 0 0110.5 5.25V3a.75.75 0 011.5 0v2.25A8.25 8.25 0 0120.25 13.5h2.25a.75.75 0 010 1.5H20.25A8.25 8.25 0 0111.25 23.25v2.25a.75.75 0 01-1.5 0v-2.25A8.25 8.25 0 012.25 15H0a.75.75 0 010-1.5h2.25z"})}),H.jsxs("div",{children:[H.jsx("p",{className:"text-sm text-gray-600",children:"Recuperación"}),H.jsxs("p",{className:"text-lg font-bold",children:[i.recoveryRate.toFixed(1),"%"]})]})]}),H.jsxs("div",{className:"bg-white p-4 rounded shadow flex items-center gap-3",children:[H.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"w-6 h-6 text-blue-600",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true",children:H.jsx("path",{fillRule:"evenodd",d:"M12 1.5a10.5 10.5 0 100 21 10.5 10.5 0 000-21zM12 3a9 9 0 110 18A9 9 0 0112 3zm-.75 4.5a.75.75 0 011.5 0v4.336l3.404 1.967a.75.75 0 01-.758 1.288l-3.75-2.167A.75.75 0 0111.25 12V7.5z",clipRule:"evenodd"})}),H.jsxs("div",{children:[H.jsx("p",{className:"text-sm text-gray-600",children:"Promedio de pago (días)"}),H.jsx("p",{className:"text-lg font-bold",children:i.avgPayDays.toFixed(1)})]})]}),i.topDebtor&&H.jsxs("div",{className:"bg-white p-4 rounded shadow flex items-center gap-3",children:[H.jsx("img",{src:GN,alt:"",className:"w-6 h-6 text-red-600"}),H.jsxs("div",{children:[H.jsx("p",{className:"text-sm text-gray-600",children:"Mayor saldo"}),H.jsx("p",{className:"text-lg font-bold",children:`${i.topDebtor.name} - $${Xn(i.topDebtor.balance)}`})]})]})]}),H.jsxs("div",{className:"grid gap-4 sm:grid-cols-2",children:[H.jsxs("div",{className:"bg-white p-4 rounded shadow",children:[H.jsx("h3",{className:"font-medium mb-2",children:"Distribución de saldos"}),H.jsxs("div",{className:"flex items-center gap-2",children:[H.jsxs("div",{className:"flex-1 h-4 bg-gray-200 rounded overflow-hidden flex",children:[H.jsx("div",{className:"bg-green-500",style:{width:`${i.dueBalance/(i.dueBalance+i.overdueBalance||1)*100}%`}}),H.jsx("div",{className:"bg-red-500",style:{width:`${i.overdueBalance/(i.dueBalance+i.overdueBalance||1)*100}%`}})]}),H.jsx("span",{className:"text-sm",children:`$${Xn(i.dueBalance)} / $${Xn(i.overdueBalance)}`})]})]}),H.jsxs("div",{className:"bg-white p-4 rounded shadow",children:[H.jsx("h3",{className:"font-medium mb-2",children:"Ventas a crédito por mes"}),H.jsxs("table",{className:"w-full text-sm text-left",children:[H.jsx("thead",{children:H.jsxs("tr",{children:[H.jsx("th",{className:"px-2 py-1 border-b",children:"Mes"}),H.jsx("th",{className:"px-2 py-1 border-b",children:"Cantidad de ventas a crédito"})]})}),H.jsx("tbody",{children:i.monthlySales.map(v=>H.jsxs("tr",{className:"odd:bg-gray-50",children:[H.jsx("td",{className:"px-2 py-1 border-b",children:v.month}),H.jsx("td",{className:"px-2 py-1 border-b text-center",children:v.count})]},v.month))})]})]})]}),e.length>0&&H.jsxs("div",{className:"space-y-2",children:[H.jsx("h3",{className:"text-lg font-semibold",children:"Clientes Morosos"}),H.jsx("ul",{className:"grid gap-3",children:e.map(v=>{const E=(v.phone||"").replace(/\D/g,"");return H.jsxs("li",{className:"card border-l-4 border-red-500",children:[H.jsxs("div",{className:"flex-1",children:[H.jsx("p",{className:"font-semibold",children:`${v.name} - $${Xn(v.balance)}`}),H.jsxs("p",{className:"text-sm text-gray-700",children:["Último abono: ",new Date(v.lastPayment).toLocaleDateString()]})]}),H.jsxs("span",{className:"actions",children:[H.jsx("button",{onClick:()=>l(v.id),title:"Abono",children:H.jsx("img",{src:Tp,alt:"abono",className:"icon"})}),E&&H.jsx("a",{href:`https://wa.me/${E}`,target:"_blank",rel:"noopener noreferrer",title:"Mensaje",children:H.jsx("img",{src:L3,alt:"mensaje",className:"icon"})})]})]},v.id)})})]}),a&&H.jsx(Oo,{onClose:()=>l(null),children:H.jsx(C3,{clientId:a,onDone:()=>{l(null),f()}})}),H.jsxs("div",{className:"flex gap-2",children:[H.jsx("button",{onClick:p,className:"bg-blue-500 text-white px-3 py-1 rounded",children:"Exportar DB"}),H.jsx("button",{onClick:()=>c.current.click(),className:"bg-blue-500 text-white px-3 py-1 rounded",children:"Importar DB"})]}),H.jsx("input",{type:"file",accept:"application/json",ref:c,style:{display:"none"},onChange:y})]})}function Bv({go:i,onDone:t,sale:e}){const[r,a]=me.useState([]),[l,c]=me.useState(e?.clientId||""),[f,p]=me.useState(e?.amount||""),[y,v]=me.useState(e?.description||""),[E,T]=me.useState(()=>e?.date?new Date(e.date).toISOString().split("T")[0]:new Date().toISOString().split("T")[0]);me.useEffect(()=>{(async()=>{const V=await Yr(Si(Le,"clients"));a(V.docs.map(G=>({id:G.id,...G.data()})))})()},[]),me.useEffect(()=>{e&&(c(e.clientId),p(e.amount),v(e.description),T(new Date(e.date).toISOString().split("T")[0]))},[e]);const A=async R=>{if(R.preventDefault(),!l||!f||!y||!E)return;const V=parseFloat(f),G=Tn(Le,"clients",l);if(e){const j=V-e.amount;await Kr(Tn(G,"sales",e.id),{amount:V,description:y,date:new Date(E).getTime()}),j!==0&&await Kr(G,{balance:ws(j),total:ws(j)})}else{const j=new Date(E).getTime();await p1(Si(G,"sales"),{amount:V,description:y,date:j}),await Kr(G,{balance:ws(V),total:ws(V)});const X=r.find(nt=>nt.id===l);if(X){const nt=new Ce({unit:"mm",format:[58,100]});nt.setFont("helvetica","bold"),nt.setFontSize(16),nt.text("Vende Más",29,8,{align:"center"}),nt.setLineWidth(.1),nt.line(5,11,53,11),nt.setFont("helvetica","normal"),nt.setFontSize(10),nt.text(`Cliente: ${X.name}`,5,17),nt.text(`Fecha: ${new Date(j).toLocaleString()}`,5,23),nt.line(5,26,53,26),nt.setFont("helvetica","bold"),nt.text("Descripción",5,32),nt.text("Monto",53,32,{align:"right"}),nt.setFont("helvetica","normal"),nt.text(String(y),5,38),nt.text(`$${Xn(V)}`,53,38,{align:"right"}),nt.line(5,44,53,44),nt.setFont("helvetica","bold"),nt.text("TOTAL:",40,50,{align:"right"}),nt.setFontSize(14),nt.text(`$${Xn(V)}`,53,50,{align:"right"}),nt.setFont("helvetica","normal"),nt.setFontSize(9),nt.text("¡Gracias por tu compra!",29,96,{align:"center"}),nt.save("ticket.pdf")}}t?t(l):i("client",l)};return H.jsxs("form",{onSubmit:A,className:"bg-white p-4 rounded shadow max-w-md mx-auto space-y-4",children:[H.jsx("h2",{className:"text-lg font-semibold text-center",children:e?"Editar Venta":"Nueva Venta"}),e?H.jsxs("p",{className:"font-medium",children:["Cliente: ",e.clientName]}):H.jsxs("select",{className:"w-full border rounded px-3 py-2",value:l,onChange:R=>c(R.target.value),required:!0,children:[H.jsx("option",{value:"",disabled:!0,children:"Selecciona un cliente"}),r.map(R=>H.jsx("option",{value:R.id,children:R.name},R.id))]}),H.jsx("input",{className:"w-full border rounded px-3 py-2",value:y,onChange:R=>v(R.target.value),placeholder:"Descripción",required:!0}),H.jsx("input",{className:"w-full border rounded px-3 py-2",value:f,onChange:R=>p(R.target.value),placeholder:"Monto",type:"number",step:"0.01",required:!0}),H.jsx("input",{className:"w-full border rounded px-3 py-2",type:"date",value:E,onChange:R=>T(R.target.value),required:!0}),H.jsx("button",{type:"submit",className:"w-full bg-blue-500 text-white py-2 rounded",children:e?"Guardar cambios":"Registrar venta"})]})}function KN(){const[i,t]=me.useState([]),[e,r]=me.useState(""),[a,l]=me.useState(!1),[c,f]=me.useState(null),{role:p}=nd(),y=async()=>{const T=await Yr(Si(Le,"clients")),A=[];for(const R of T.docs)(await Yr(Si(Le,"clients",R.id,"sales"))).forEach(G=>{A.push({id:G.id,clientId:R.id,clientName:R.data().name,...G.data()})});t(A)};me.useEffect(()=>{y()},[]);const v=async T=>{window.confirm("¿Eliminar esta venta?")&&(await ch(Tn(Le,"clients",T.clientId,"sales",T.id)),await Kr(Tn(Le,"clients",T.clientId),{balance:ws(-T.amount),total:ws(-T.amount)}),y())},E=i.filter(T=>T.clientName.toLowerCase().includes(e.toLowerCase()));return H.jsxs("div",{className:"space-y-4",children:[H.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-2",children:[H.jsxs("button",{onClick:()=>l(!0),className:"flex items-center gap-2 bg-blue-500 text-white px-3 py-2 rounded w-full sm:w-auto",children:[H.jsx("img",{src:Um,alt:"",className:"w-5 h-5"}),"Nueva venta"]}),H.jsxs("div",{className:"relative w-full sm:w-auto",children:[H.jsx("input",{className:"border rounded px-3 py-2 pr-8 w-full",placeholder:"Buscar por cliente",value:e,onChange:T=>r(T.target.value)}),e&&H.jsx("button",{type:"button",onClick:()=>r(""),className:"absolute right-2 top-1/2 -translate-y-1/2 text-gray-700",children:"×"})]})]}),H.jsx("ul",{className:"grid gap-3",children:E.map(T=>H.jsxs("li",{className:"card border-l-4 border-blue-500",children:[H.jsxs("div",{className:"flex-1",children:[H.jsx("p",{className:"font-semibold",children:T.clientName}),H.jsxs("p",{className:"text-sm text-gray-800",children:[new Date(T.date).toLocaleDateString()," - ",T.description," - $",Xn(T.amount)]})]}),H.jsx("span",{className:"actions",children:p==="Administrador"&&H.jsxs(H.Fragment,{children:[H.jsx("button",{onClick:()=>f(T),title:"Editar",children:H.jsx("img",{src:vh,alt:"editar",className:"icon"})}),H.jsx("button",{onClick:()=>v(T),title:"Eliminar",children:H.jsx("img",{src:Of,alt:"eliminar",className:"icon"})})]})})]},`${T.clientId}-${T.id}`))}),a&&H.jsx(Oo,{onClose:()=>l(!1),children:H.jsx(Bv,{onDone:()=>{l(!1),y()}})}),p==="Administrador"&&c&&H.jsx(Oo,{onClose:()=>f(null),children:H.jsx(Bv,{sale:c,onDone:()=>{f(null),y()}})})]})}function QN({onDone:i}){const[t,e]=me.useState(""),[r,a]=me.useState(""),[l,c]=me.useState("Vendedor"),f=async p=>{p.preventDefault(),r&&(await _u(Tn(Le,"usuarios",r),{createdAt:Date.now(),name:t,role:l}),i&&i())};return H.jsxs("form",{onSubmit:f,className:"bg-white p-4 rounded shadow max-w-md mx-auto space-y-4",children:[H.jsx("h2",{className:"text-lg font-semibold text-center",children:"Nuevo Usuario"}),H.jsx("input",{className:"w-full border rounded px-3 py-2",value:t,onChange:p=>e(p.target.value),placeholder:"Nombre",required:!0}),H.jsx("input",{className:"w-full border rounded px-3 py-2",type:"email",value:r,onChange:p=>a(p.target.value),placeholder:"Correo",required:!0}),H.jsxs("select",{className:"w-full border rounded px-3 py-2",value:l,onChange:p=>c(p.target.value),children:[H.jsx("option",{value:"Vendedor",children:"Vendedor"}),H.jsx("option",{value:"Administrador",children:"Administrador"})]}),H.jsx("button",{type:"submit",className:"w-full bg-blue-500 text-white py-2 rounded",children:"Guardar"})]})}function XN({user:i,onDone:t}){const[e,r]=me.useState("");me.useEffect(()=>{r(i.displayName||"")},[i]);const a=async l=>{l.preventDefault(),e&&(await Kr(Tn(Le,"users",i.id),{displayName:e}),t&&t())};return H.jsxs("form",{onSubmit:a,className:"bg-white p-4 rounded shadow max-w-md mx-auto space-y-4",children:[H.jsx("h2",{className:"text-lg font-semibold text-center",children:"Editar nombre"}),H.jsx("input",{className:"w-full border rounded px-3 py-2",value:e,onChange:l=>r(l.target.value),placeholder:"Nombre",required:!0}),H.jsx("button",{type:"submit",className:"w-full bg-blue-500 text-white py-2 rounded",children:"Guardar"})]})}function WN(){const[i,t]=me.useState([]),[e,r]=me.useState([]),[a,l]=me.useState(!1),[c,f]=me.useState(null),p=async()=>{const T=await Yr(Si(Le,"usuarios"));t(T.docs.map(R=>({id:R.id,...R.data()})));const A=await Yr(Si(Le,"users"));r(A.docs.map(R=>({id:R.id,...R.data()})))};me.useEffect(()=>{p()},[]);const y=async T=>{await ch(Tn(Le,"usuarios",T)),p()},v=async(T,A,R)=>{T&&await Kr(Tn(Le,"users",T),{role:R}),await Kr(Tn(Le,"usuarios",A),{role:R}),p()},E=i.map(T=>{const A=e.find(R=>R.email===T.id);return{email:T.id,name:A?.displayName||T.name,photoURL:A?.photoURL,role:A?.role||T.role||"Vendedor",userId:A?.id}});return H.jsxs("div",{className:"space-y-6",children:[H.jsx("div",{className:"flex justify-start",children:H.jsxs("button",{onClick:()=>l(!0),className:"flex items-center gap-2 bg-blue-500 text-white px-3 py-2 rounded w-full sm:w-auto",children:[H.jsx("img",{src:Um,alt:"",className:"w-5 h-5"}),"Nuevo usuario"]})}),H.jsxs("div",{className:"space-y-2",children:[H.jsx("h3",{className:"text-lg font-semibold",children:"Usuarios Registrados"}),H.jsx("ul",{className:"grid gap-2",children:E.map(T=>H.jsxs("li",{className:"card sm:flex-row sm:items-center",children:[H.jsx("img",{src:T.photoURL||"/vite.svg",alt:"avatar",className:"w-12 h-12 rounded-full"}),H.jsxs("div",{className:"flex-1",children:[H.jsx("p",{className:"font-semibold",children:T.name||T.email}),H.jsx("p",{className:"text-sm text-gray-600",children:T.email})]}),H.jsxs("select",{value:T.role,onChange:A=>v(T.userId,T.email,A.target.value),className:"border rounded px-2 py-1",children:[H.jsx("option",{value:"Vendedor",children:"Vendedor"}),H.jsx("option",{value:"Administrador",children:"Administrador"})]}),T.userId&&H.jsx("button",{onClick:()=>f(e.find(A=>A.id===T.userId)),title:"Editar nombre",children:H.jsx("img",{src:vh,alt:"editar",className:"icon"})}),H.jsx("button",{onClick:()=>y(T.email),className:"bg-red-500 text-white px-2 py-1 rounded",children:"Eliminar"})]},T.email))})]}),a&&H.jsx(Oo,{onClose:()=>l(!1),children:H.jsx(QN,{onDone:()=>{l(!1),p()}})}),c&&H.jsx(Oo,{onClose:()=>f(null),children:H.jsx(XN,{user:c,onDone:()=>{f(null),p()}})})]})}function $N(){const{login:i}=nd();return H.jsx("div",{className:"flex items-center justify-center h-screen bg-gray-100",children:H.jsxs("div",{className:"bg-white p-6 rounded shadow text-center space-y-4",children:[H.jsx("img",{src:"/assets/logo.png",alt:"Claus Vende",className:"h-12 mx-auto"}),H.jsx("h2",{className:"text-xl font-semibold text-gray-700",children:"Ingresa"}),H.jsx("button",{onClick:i,className:"bg-blue-900 text-white px-4 py-2 rounded",children:"Iniciar sesión con Google"})]})})}function JN({page:i,setPage:t}){const{user:e,role:r,logout:a}=nd(),[l,c]=me.useState(!1);if(!e)return H.jsx($N,{});const f=T=>{const A=T?T.trim().split(/\s+/):[];return A.length<=2?{nombres:A[0]||"",apellidos:A.slice(1).join(" ")}:{nombres:A.slice(0,A.length-2).join(" "),apellidos:A.slice(A.length-2).join(" ")}},{nombres:p,apellidos:y}=f(e.displayName),v=(T,A=null)=>{(T==="finance"||T==="users")&&r!=="Administrador"||(t({name:T,clientId:A}),c(!1))};let E;switch(i.name){case"clients":E=H.jsx(Uv,{go:v});break;case"sales":E=H.jsx(KN,{});break;case"finance":E=r==="Administrador"?H.jsx(YN,{}):H.jsx("p",{className:"text-center",children:"Acceso restringido"});break;case"users":E=r==="Administrador"?H.jsx(WN,{}):H.jsx("p",{className:"text-center",children:"Acceso restringido"});break;case"client":E=H.jsx(zN,{id:i.clientId,go:v});break;default:E=H.jsx(Uv,{go:v})}return H.jsxs("div",{className:"flex min-h-screen bg-gray-100",children:[l&&H.jsx("div",{className:"fixed inset-0 bg-black/50 md:hidden z-10",onClick:()=>c(!1)}),H.jsxs("aside",{className:`bg-blue-900 text-white w-60 p-4 space-y-2 fixed inset-y-0 left-0 transform ${l?"translate-x-0":"-translate-x-full"} transition-transform md:relative md:translate-x-0 z-20`,children:[H.jsx("button",{className:"md:hidden absolute top-2 right-2 text-2xl",onClick:()=>c(!1),children:"×"}),H.jsx("h1",{className:"text-lg font-semibold mb-4 text-center",children:"Menú"}),H.jsxs("nav",{className:"flex flex-col gap-2",children:[H.jsxs("button",{onClick:()=>v("sales"),className:"flex items-center gap-2 px-3 py-2 rounded hover:bg-blue-500 text-left group",children:[H.jsx("svg",{className:"w-5 h-5 text-current group-hover:text-white",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true",children:H.jsx("path",{d:"M2.25 2.25a.75.75 0 000 1.5h1.386c.17 0 .318.114.362.278l2.558 9.592a3.752 3.752 0 00-2.806 3.63c0 .414.336.75.75.75h15.75a.75.75 0 000-1.5H5.378A2.25 2.25 0 017.5 15h11.218a.75.75 0 00.674-.421 60.358 60.358 0 002.96-7.228.75.75 0 00-.525-.965A60.864 60.864 0 005.68 4.509l-.232-.867A1.875 1.875 0 003.636 2.25H2.25zM3.75 20.25a1.5 1.5 0 113 0 1.5 1.5 0 01-3 0zM16.5 20.25a1.5 1.5 0 113 0 1.5 1.5 0 01-3 0z"})}),"Ventas"]}),H.jsxs("button",{onClick:()=>v("clients"),className:"flex items-center gap-2 px-3 py-2 rounded hover:bg-blue-500 text-left group",children:[H.jsxs("svg",{className:"w-5 h-5 text-current group-hover:text-white",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true",children:[H.jsx("path",{"fill-rule":"evenodd",d:"M8.25 6.75a3.75 3.75 0 117.5 0 3.75 3.75 0 01-7.5 0zM15.75 9.75a3 3 0 116 0 3 3 0 01-6 0zM2.25 9.75a3 3 0 116 0 3 3 0 01-6 0zM6.31 15.117A6.745 6.745 0 0112 12a6.745 6.745 0 016.709 7.498.75.75 0 01-.372.568A12.696 12.696 0 0112 21.75c-2.305 0-4.47-.612-6.337-1.684a.75.75 0 01-.372-.568 6.787 6.787 0 011.019-4.38z","clip-rule":"evenodd"}),H.jsx("path",{d:"M5.082 14.254a8.287 8.287 0 00-1.308 5.135 9.687 9.687 0 01-1.764-.44l-.115-.04a.563.563 0 01-.373-.487l-.01-.121a3.75 3.75 0 013.57-4.047zM20.226 19.389a8.287 8.287 0 00-1.308-5.135 3.75 3.75 0 013.57 4.047l-.01.121a.563.563 0 01-.373.486l-.115.04c-.567.2-1.156.349-1.764.441z"})]}),"Clientes"]}),r==="Administrador"&&H.jsxs(H.Fragment,{children:[H.jsxs("button",{onClick:()=>v("finance"),className:"flex items-center gap-2 px-3 py-2 rounded hover:bg-blue-500 text-left group",children:[H.jsxs("svg",{className:"w-5 h-5 text-current group-hover:text-white",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true",children:[H.jsx("path",{d:"M10.464 8.746c.227-.18.497-.311.786-.394v2.795a2.252 2.252 0 01-.786-.393c-.394-.313-.546-.681-.546-1.004 0-.323.152-.691.546-1.004zM12.75 15.662v-2.824c.347.085.664.228.921.421.427.32.579.686.579.991 0 .305-.152.671-.579.991a2.534 2.534 0 01-.921.42z"}),H.jsx("path",{"fill-rule":"evenodd",d:"M12 2.25c-5.385 0-9.75 4.365-9.75 9.75s4.365 9.75 9.75 9.75 9.75-4.365 9.75-9.75S17.385 2.25 12 2.25zM12.75 6a.75.75 0 00-1.5 0v.816a3.836 3.836 0 00-1.72.756c-.712.566-1.112 1.35-1.112 2.178 0 .829.4 1.612 1.113 2.178.502.4 1.102.647 1.719.756v2.978a2.536 2.536 0 01-.921-.421l-.879-.66a.75.75 0 00-.9 1.2l.879.66c.533.4 1.169.645 1.821.75V18a.75.75 0 001.5 0v-.81a4.124 4.124 0 001.821-.749c.745-.559 1.179-1.344 1.179-2.191 0-.847-.434-1.632-1.179-2.191a4.122 4.122 0 00-1.821-.75V8.354c.29.082.559.213.786.393l.415.33a.75.75 0 00.933-1.175l-.415-.33a3.836 3.836 0 00-1.719-.755V6z","clip-rule":"evenodd"})]}),"Finanzas"]}),H.jsxs("button",{onClick:()=>v("users"),className:"flex items-center gap-2 px-3 py-2 rounded hover:bg-blue-500 text-left group",children:[H.jsx("svg",{className:"w-5 h-5 text-current group-hover:text-white",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true",children:H.jsx("path",{d:"M15.75 9A3.75 3.75 0 1112 5.25 3.75 3.75 0 0115.75 9zm-7.5 0A3.75 3.75 0 115 5.25 3.75 3.75 0 018.25 9zM3 20.25a8.25 8.25 0 1118 0v1.5H3v-1.5z"})}),"Usuarios"]})]})]})]}),H.jsxs("div",{className:"flex-1 flex flex-col",children:[H.jsxs("header",{className:"fixed top-0 left-0 right-0 md:left-60 md:right-4 bg-white shadow",children:[H.jsx("div",{className:"px-4 py-2 text-center",children:H.jsx("img",{src:"/assets/logo.png",alt:"Claus Vende",className:"h-8 mx-auto"})}),H.jsxs("div",{className:"flex items-center justify-between px-4 py-2 border-t",children:[H.jsxs("div",{className:"flex items-center gap-2",children:[H.jsx("button",{className:"md:hidden text-2xl mr-2",onClick:()=>c(!l),children:"☰"}),H.jsxs("div",{className:"flex items-center gap-2",children:[H.jsx("img",{src:e.photoURL,alt:"avatar",className:"w-8 h-8 rounded-full"}),H.jsxs("div",{className:"leading-tight",children:[H.jsx("p",{className:"font-semibold leading-tight md:hidden",children:p}),H.jsx("p",{className:"font-semibold leading-tight md:hidden",children:y}),H.jsx("p",{className:"font-semibold leading-none hidden md:block",children:e.displayName}),H.jsx("p",{className:"text-xs text-gray-700",children:r})]})]})]}),H.jsx("button",{onClick:a,className:"bg-red-500 text-white px-3 py-1 rounded",children:"Cerrar sesión"})]})]}),H.jsx("main",{className:"p-4 pt-36 md:pt-36 flex-1",children:E})]})]})}function ZN(){const[i,t]=me.useState({name:"clients"});return H.jsx(Ux,{children:H.jsx(JN,{page:i,setPage:t})})}z4.createRoot(document.getElementById("root")).render(H.jsx(me.StrictMode,{children:H.jsx(ZN,{})}));export{kn as _};
